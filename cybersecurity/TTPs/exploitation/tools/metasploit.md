
# Metasploit
Metasploit Framework is an open-source set of tools which can be used for information gathering, scanning, exploitation, exploit development, post exploitation, etc.. Primary use is for ethical hacking/ pen-testing.
## Main components
### `msfconsole`
Main CL interface.
### Modules
Modules are anything which is packaged up and can be used to perform a specific task:
- Exploits: piece of code which uses a vulnerability in a target system
- Payload: the code which runs on a target system once it has been accessed maliciously (via an exploit)
- Evasions: these modules attempt to evade antivirus software.
- Post: Post modules are useful on the final stage of a penetration test b/c they help cleanup any leftover evidence from the exploit/ payload/ etc.
- Auxiliary: Any supporting modules like scanners, crawlers, fuzzers, etc.
### Encoders
Allow you to encode an exploit and payload so that it won't be detected by a signature-based antivirus 
#### Signature-Based Antivirus 
Software which uses a DB of known threats which they use to detect suspicious files (by comparing them to the DB). Even with encoders, the *success rate is limited* b/c antivirus software can use *other checks* to detect malicious software.
### NOPs (No Operations)
`NOP`s are pieces of code which are designed to literally do nothing and are used as buffers to achieve consistent payload sizes. The `NOP`s used in Metasploit are represented by Intel x86 CPU family.
## Creating a shell
Metasploit offers payloads which can open shells on a target system. A [shell](/PNPT/PEH/exploit-basics/shells.md) is a persistent, interactive connection b/w an "attacker" (or Metasploit/ msfconsole) and the target machine which allows for the execution of commands on the target system.
## Types of Payloads
In msfconsole, under ``payloads`` there are 3 different directories:
### Singles 
Self-contained payloads which don't need to download any other components to run.
### Stagers 
Used w/ 'staged' payloads to set up a connection channel b/w Metasploit and the target system. Staged payloads will upload a stager first on the target, then download the rest of the payload (the stage). This is useful because *the initial size of the payload will be smaller than the full payload*
### Stages
Payloads downloaded by the stager, allows for larger payload sizes. 
## Tools
Stand-alone tools which help w/ vulnerability finding/ research/ assessment and penetration testing. Some examples of tools included in Metasploit are `msfvenom` and [pattern create](/PNPT/PEH/buffer-overflows/pattern-create.md).
### MSFvenom
`msfvenom` is a tool in metasploit which replaced the `msfpayload` and `msfencode` tools. It's used to *generate and encode payloads* and runs as a standalone command line tool:
```bash
msfvenom -a x86 --platform Windows -p windows/shell/bind_tcp -e x86/shikata_ga_nai -b '\x00' -i 3 -f python
Found 1 compatible encoders
Attempting to encode payload with 3 iterations of x86/shikata_ga_nai
x86/shikata_ga_nai succeeded with size 326 (iteration=0)
x86/shikata_ga_nai succeeded with size 353 (iteration=1)
x86/shikata_ga_nai succeeded with size 380 (iteration=2)
x86/shikata_ga_nai chosen with final size 380
Payload size: 380 bytes
buf = ""
buf += "\xbb\x78\xd0\x11\xe9\xda\xd8\xd9\x74\x24\xf4\x58\x31"
buf += "\xc9\xb1\x59\x31\x58\x13\x83\xc
...
```
- `-a`: the architecture to use ([x86](../../../../computers/concepts/x86.md) in this case)
- `--platform`: the OS platform of the target
- `-p`: the payload you want encoded (points at a file)
	- `--payload-options`: you can also add this flag to list the payload's standard options
- `-e`: the encoder to use
- `-b`: list of characters to avoid
- `-i`: the number of times to encode the payload
- `-f`: the output format
## Use
![](/PNPT/PEH/exploit-basics/gaining-root.md#Running%20Metasploit)
See [my notes on gaining root w/ Metasploit](https://github.com/TrshPuppy/PNPT-study-guide/blob/main/PEH/exploit-basics/gaining-root.md) from studying for the PNPT.

> [!Resources]
> - [Metasploit](https://www.metasploit.com)
> - [MSFvenom] (https://www.offsec.com/metasploit-unleashed/msfvenom/)
> - My previous notes (linked throughout the text) can all be found [here](https://github.com/TrshPuppy/obsidian-notes)


